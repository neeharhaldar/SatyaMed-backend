<!DOCTYPE html>
<html>
<head>
  <title>SatyaMed</title>

  <!-- Mobile viewport -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: #f5f7fb;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 600px;
      margin: auto;
      padding: 16px;
    }
    h2 { text-align: center; margin-bottom: 10px; }
    select {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      margin-bottom: 12px;
    }
    .card {
      background: white;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    textarea, input {
      width: 100%;
      font-size: 16px;
      padding: 10px;
      margin-top: 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    button {
      width: 100%;
      margin-top: 10px;
      padding: 12px;
      font-size: 16px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
    }
    .primary { background: #2563eb; color: white; }
    .secondary { background: #e5e7eb; color: #111; }
    .speak { background: #16a34a; color: white; }
    pre {
      background: #f1f5f9;
      padding: 10px;
      border-radius: 8px;
      font-size: 14px;
      white-space: pre-wrap;
      word-wrap: break-word;
      margin-top: 10px;
    }
    .footer {
      text-align: center;
      font-size: 13px;
      color: #555;
      margin-top: 20px;
    }
  </style>
</head>

<body>
<div class="container">

  <h2 id="title">SatyaMed</h2>

  <!-- Language Selector -->
  <select id="language" onchange="setLanguage()">
    <option value="hi" selected>‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
    <option value="en">English</option>
  </select>

  <!-- SCAN IMAGE -->
  <div class="card">
    <h3 id="scanTitle">Scan Medicine Strip</h3>
    <input type="file" id="imageInput" accept="image/*" capture="environment">
    <button id="scanBtn" class="secondary" onclick="scanImage()">Scan Imageüîç</button>
    <pre id="imageResult"></pre>
    <button id="speakImageBtn" class="speak" onclick="speak('imageResult')">Read Aloudüì¢</button>
  </div>

  <!-- VERIFY MESSAGE -->
  <div class="card">
    <h3 id="verifyTitle">Verify Health Message</h3>
    <textarea id="text" rows="4"
      placeholder="Paste health message here"></textarea>
    <button id="verifyBtn" class="primary" onclick="verify()">Verifyüîç</button>
    <pre id="result"></pre>
    <button id="speakVerifyBtn" class="speak" onclick="speak('result')">Read Aloudüì¢</button>
  </div>

  <!-- ASK SAFETY -->
  <div class="card">
    <h3 id="askTitle">Ask Medicine Safety Question</h3>
    <input id="question"
      placeholder="e.g. Can I take antibiotics for cold?">
    <button id="askBtn" class="primary" onclick="askSafety()">Asküîç</button>
    <pre id="safetyResult"></pre>
    <button id="speakSafetyBtn" class="speak" onclick="speak('safetyResult')">Read Aloudüì¢</button>
  </div>

  <div class="footer">
    SatyaMed ‚Ä¢ Made by Neehar Haldar for CODON Hackathon, 2026
  </div>

</div>

<script>
/* ================= STATE ================= */
let currentLang = "hi";

/* ================= UI TEXT ================= */
const UI_TEXT = {
  en: {
    title: "SatyaMed",
    verifyTitle: "Verify Health Message",
    verifyBtn: "Verifyüîç",
    verifyPlaceholder: "Paste health message here",
    askTitle: "Ask Medicine Safety Question",
    askPlaceholder: "e.g. Can I take antibiotics for cold?",
    askBtn: "Asküîç",
    scanTitle: "Scan Medicine Strip",
    scanBtn: "Scan Imageüîç",
    speakBtn: "Read Aloudüì¢"
  },
  hi: {
    title: "‡§∏‡§§‡•ç‡§Ø‡§æ‡§Æ‡•á‡§°",
    verifyTitle: "‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç",
    verifyBtn: "‡§ú‡§æ‡§Ç‡§ö‡•á‡§Çüîç",
    verifyPlaceholder: "‡§Ø‡§π‡§æ‡§Å ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§ö‡§ø‡§™‡§ï‡§æ‡§è‡§Å",
    askTitle: "‡§¶‡§µ‡§æ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§™‡•Ç‡§õ‡•á‡§Ç",
    askPlaceholder: "‡§ú‡•à‡§∏‡•á: ‡§ï‡•ç‡§Ø‡§æ ‡§∏‡§∞‡•ç‡§¶‡•Ä ‡§Æ‡•á‡§Ç ‡§è‡§Ç‡§ü‡•Ä‡§¨‡§æ‡§Ø‡•ã‡§ü‡§ø‡§ï ‡§≤‡•á‡§®‡§æ ‡§∏‡§π‡•Ä ‡§π‡•à?",
    askBtn: "‡§™‡•Ç‡§õ‡•á‡§Çüîç",
    scanTitle: "‡§¶‡§µ‡§æ ‡§ï‡•Ä ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç",
    scanBtn: "‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Çüîç",
    speakBtn: "‡§Ü‡§µ‡§æ‡§ú‡§º ‡§Æ‡•á‡§Ç ‡§∏‡•Å‡§®‡•á‡§Çüì¢"
  }
};

const LABEL_TEXT = {
  en: {
    verdict: "Verdict",
    confidence: "Confidence",
    why: "Why",
    potential_harm: "Potential harm",
    correct_information: "Correct information",
    what_to_do: "What to do",

    answer: "Answer",
    what_not_to_do: "What NOT to do",
    when_to_see_doctor: "When to see a doctor",
    risk_level: "Risk level",

    generic_name: "Generic name",
    category: "Category",
    warnings: "Warnings",
    advice: "Advice"
  },
  hi: {
    verdict: "‡§®‡§ø‡§∞‡•ç‡§£‡§Ø",
    confidence: "‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§∏‡•ç‡§§‡§∞",
    why: "‡§ï‡•ç‡§Ø‡•ã‡§Ç",
    potential_harm: "‡§∏‡§Ç‡§≠‡§æ‡§µ‡§ø‡§§ ‡§®‡•Å‡§ï‡§∏‡§æ‡§®",
    correct_information: "‡§∏‡§π‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä",
    what_to_do: "‡§ï‡•ç‡§Ø‡§æ ‡§ï‡§∞‡•á‡§Ç",

    answer: "‡§â‡§§‡•ç‡§§‡§∞",
    what_not_to_do: "‡§ï‡•ç‡§Ø‡§æ ‡§® ‡§ï‡§∞‡•á‡§Ç",
    when_to_see_doctor: "‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§∏‡•á ‡§ï‡§¨ ‡§Æ‡§ø‡§≤‡•á‡§Ç",
    risk_level: "‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§∏‡•ç‡§§‡§∞",

    generic_name: "‡§¶‡§µ‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ",
    category: "‡§∂‡•ç‡§∞‡•á‡§£‡•Ä",
    warnings: "‡§ö‡•á‡§§‡§æ‡§µ‡§®‡•Ä",
    advice: "‡§∏‡§≤‡§æ‡§π"
  }
};

/* ================= LANGUAGE ================= */
function setLanguage(){
  currentLang = language.value;
  const t = UI_TEXT[currentLang];

  title.innerText = t.title;
  verifyTitle.innerText = t.verifyTitle;
  verifyBtn.innerText = t.verifyBtn;
  text.placeholder = t.verifyPlaceholder;

  askTitle.innerText = t.askTitle;
  askBtn.innerText = t.askBtn;
  question.placeholder = t.askPlaceholder;

  scanTitle.innerText = t.scanTitle;
  scanBtn.innerText = t.scanBtn;

  speakVerifyBtn.innerText = t.speakBtn;
  speakSafetyBtn.innerText = t.speakBtn;
  speakImageBtn.innerText = t.speakBtn;
}
setLanguage();

/* ================= API CALLS ================= */
async function verify(){
  const res = await fetch("/check_text",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({ text: text.value, lang: currentLang })
  });

  const d = await res.json();
  const L = LABEL_TEXT[currentLang];

  result.innerText =
`${L.verdict}: ${d.verdict}
${L.confidence}: ${d.confidence}

${L.why}:
${d.why}

${L.potential_harm}:
${d.potential_harm}

${L.correct_information}:
${d.correct_information}

${L.what_to_do}:
${d.what_to_do}`;
}

async function askSafety(){
  const res = await fetch("/ask_safety",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({ question: question.value, lang: currentLang })
  });

  const d = await res.json();
  const L = LABEL_TEXT[currentLang];

  safetyResult.innerText =
`${L.answer}:
${d.short_answer}

${L.why}:
${d.why}

${L.what_to_do}:
${d.what_to_do}

${L.what_not_to_do}:
${d.what_not_to_do}

${L.when_to_see_doctor}:
${d.when_to_see_doctor}

${L.risk_level}: ${d.risk_level}`;
}

async function scanImage(){
  const f = imageInput.files[0];
  if (!f) return;

  const fd = new FormData();
  fd.append("file", f);
  fd.append("lang", currentLang);

  const res = await fetch("/check_image", { method:"POST", body: fd });
  const d = await res.json();

  const L = LABEL_TEXT[currentLang];

  imageResult.innerText =
`${L.generic_name}: ${d.generic_name}
${L.category}: ${d.category}

${L.warnings}:
${d.warnings}

${L.advice}:
${d.advice}`;
}

/* ================= READ ALOUD ================= */
function speak(id){
  const t = document.getElementById(id).innerText;
  if (!t) return;

  if (window.Android) {
    Android.speak(t);
  } else {
    const u = new SpeechSynthesisUtterance(t);
    u.lang = currentLang === "hi" ? "hi-IN" : "en-IN";
    speechSynthesis.speak(u);
  }
}

/* ================= SHARE ================= */
window.handleSharedText = function(t){
  text.value = t;
  verify();
};
</script>

</body>
</html>
